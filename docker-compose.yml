services:
  # OSRM: Open Source Routing Machine for car routing
  # Requires preprocessed .osrm files in ./osrm-data (run scripts/setup_osrm_korea.sh first)
  osrm:
    image: osrm/osrm-backend:latest
    platform: linux/amd64
    container_name: osrm-backend
    ports:
      - "5001:5000"  # OSRM API: host:5001 -> container:5000
    volumes:
      - ./osrm-data:/data
    command: osrm-routed --algorithm mld -p 5000 /data/korea-latest.osrm
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:5000/route/v1/driving/127.0,36.0;127.1,36.1 || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 10s

  # VROOM: Vehicle Routing Optimization Open-source Mobility
  # HTTP server that solves VRP problems using OSRM for routing
  # Accessible at http://localhost:3000/
  vroom:
    image: iedmrc/vroom:latest
    platform: linux/amd64
    container_name: vroom-server
    ports:
      - "3000:3000"  # VROOM API: host:3000 -> container:3000
    environment:
      - OSRM_ADDRESS=http://osrm:5000  # Internal Docker network address
    depends_on:
      osrm:
        condition: service_healthy
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:3000/ || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
